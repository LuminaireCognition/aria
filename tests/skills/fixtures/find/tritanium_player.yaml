# Test fixture: Player market item search
# Tests finding player-traded commodities

name: "Tritanium player market search"
skill: find
description: |
  Search for Tritanium from player market sources.
  Player orders have shorter durations (< 364 days) and variable pricing.
  Common items like minerals will have many sources nearby.

input:
  item: Tritanium
  origin: Jita
  source_filter: player
  max_jumps: 5

expected_output:
  type_id: 34
  type_name: "Tritanium"
  origin_system: "Jita"
  origin_region: "The Forge"
  source_filter_applied: "player"
  source_filter_suggested: "all"
  total_found: 150
  regions_searched:
    - "The Forge"
  sources:
    - order_id: 6600000001
      price: 4.50
      volume_remain: 500000000
      volume_total: 1000000000
      station_id: 60003760
      station_name: "Jita IV - Moon 4 - Caldari Navy Assembly Plant"
      system_id: 30000142
      system_name: "Jita"
      security: 0.95
      region_id: 10000002
      region_name: "The Forge"
      jumps_from_origin: 0
      route_security: "high"
      duration: 90
      is_npc: false
      issued: "2024-01-15T12:00:00Z"
      price_flags: []
  jita_reference_price: 4.50
  warnings: []

expected_facts:
  # Type validation - Tritanium is type_id 34
  - path: "type_id"
    equals: 34

  - path: "type_name"
    equals: "Tritanium"

  # Filter validation
  - path: "source_filter_applied"
    equals: "player"

  # All sources must be player orders (is_npc = false)
  - path: "sources[*].is_npc"
    all_satisfy: "== 0"

  # Player orders have duration < 364
  - path: "sources[*].duration"
    all_satisfy: "< 364"

  # Prices should be positive
  - path: "sources[*].price"
    all_satisfy: "> 0"

  # High-volume commodity should have significant volume
  - path: "sources[*].volume_remain"
    all_satisfy: "> 0"
