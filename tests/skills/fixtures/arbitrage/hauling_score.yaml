# Test fixture: Arbitrage with hauling score
# Tests V2 hauling score calculation features

name: "Arbitrage with hauling score"
skill: arbitrage
description: |
  Arbitrage scan with cargo capacity specified for hauling score calculation.
  Tests V2 features: profit density, safe quantity, and limiting factors.

input:
  min_profit_pct: 10
  min_volume: 100
  cargo_capacity_m3: 5000
  sort_by: "hauling_score"

expected_output:
  opportunities:
    - type_id: 16672
      type_name: "Tritanium"
      buy_region: "Metropolis"
      buy_region_id: 10000042
      sell_region: "The Forge"
      sell_region_id: 10000002
      buy_price: 4.00
      sell_price: 4.80
      profit_per_unit: 0.80
      profit_pct: 20.0
      available_volume: 500000000
      route_jumps: 28
      route_safe: true
      freshness: "fresh"
      confidence: "high"
      item_volume_m3: 0.01
      profit_density: 76.8
      gross_profit_per_unit: 0.80
      net_profit_per_unit: 0.768
      gross_margin_pct: 20.0
      net_margin_pct: 19.2
      trade_mode: "immediate"
      broker_fee_pct: 0.03
      sales_tax_pct: 0.036
      hauling_score: 38400.0
      safe_quantity: 500000
      expected_profit: 384000.0
      fill_ratio: 1.0
      limiting_factor: "cargo"
      limiting_factors:
        - "cargo"
  total_found: 15
  regions_scanned:
    - "The Forge"
    - "Domain"
    - "Sinq Laison"
    - "Heimatar"
    - "Metropolis"
  scan_timestamp: 1705320000
  data_freshness: "fresh"
  refresh_performed: false
  warnings: []

expected_facts:
  # Hauling score should be positive
  - path: "opportunities[*].hauling_score"
    all_satisfy: "> 0"

  # Safe quantity should be positive
  - path: "opportunities[*].safe_quantity"
    all_satisfy: ">= 0"

  # Expected profit should be positive
  - path: "opportunities[*].expected_profit"
    all_satisfy: "> 0"

  # Fill ratio should be between 0 and 1
  - path: "opportunities[*].fill_ratio"
    all_satisfy: "<= 1"

  - path: "opportunities[*].fill_ratio"
    all_satisfy: ">= 0"

  # Limiting factor should be present
  - path: "opportunities[0].limiting_factor"
    equals: "cargo"

  # Net profit should be less than gross (fees deducted)
  - path: "opportunities[0].net_profit_per_unit"
    range: [0.5, 0.9]

  # Profit density should be positive
  - path: "opportunities[*].profit_density"
    all_satisfy: "> 0"
